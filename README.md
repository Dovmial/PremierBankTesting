# PremierBankApi

Доп. настройка для запуска.  
(для .env, но можно и иным удобным способом задать переменную окружения (setX, Gui, реестр..)))
1. создать файл **.env** возле Program.cs
2. прописать там переменную **POSTGRESS_CONNECTION_STRIG_PREMIERDB=**
3. заполнить ее значением строки подключения к постгресс. пример формата: **Host=localhost;Port=5432;Database=BankPremierDb;Username=postgres;Password=admin;**
4. создание базы и накат миграций автоматические при запуске.  


Внесение данных осуществляется методами с помеченными как Test в названии  
<img width="450" height="450" alt="image" src="https://github.com/user-attachments/assets/2ad5cff4-b473-4bdb-8158-e7b0b5d22d90" />  
**TestTranscactionFromclient** - возвращает данные, заданные изначально в клиенте.  
**addTestUser** - добавляет уникальных пользователей из стартовых транзакций  
**saveTestTransactions** - сохраняет эти транзакции стартовые (можно несколько раз, чтобы выборка для группировок была больше)

*твоим объяснением бага (см. пункт 2)* видимо речь об отсутвии реализации интерфейса. все остальное работало, багу словить не удалось.  

# Варианты мелких возможных улучшений  

1. guid => создавать ver 7 (net9) или ULID в качестве первичного ключа, лучше индексируются и сортируются из-за отметки времени в структуре
2. мидлвар для ловли исключений, чтобы от try контроллеры очистить или паттерн OperationResult
3. при большой команде и проекте -> CQRS + clean Architect + Mediatr
4. У пользователя добавить доп поля, нормализованных версий строк
5. поле Comment скорее всего вовсе не комметарий а разновидность транзакции (enum), но это надо на конкретный бизнес смотреть
6. isProcessed  -> тоже может быть набором кодов статусов, а не bool
7. unit тесты, может быть.
8. логи чуть чаще. (в простых методах опускал)

## Task6
Архитектура: Можно много разных вариантов и чистую с usecase в слое app и в одном проекте с сервисами и репозиториями.
  Здесь взаимодействие с БД вынесено отдельно. За счет DI нет прямых зависимостей от реализаций. 
  - Контроллер дергает сервис, сервис мапит данные до моделей базы и манипулирует разными репозиториями для формирования данных.
  - Сервис для простоты в виде фасада над этим банком, делегирует всю работу с базой разным репозиториям. Бизнес-логикой тут севис занимается.
  - репозитории как надстройка на dbContext и провайдером базы. Все, кто выше не в курсе какая тут база, репозитории только доступ на чтение-запись обеспечивают
  - дто на разных слоях свои. 
  - сама схема <img width="914" height="646" alt="image" src="https://github.com/user-attachments/assets/598d50bb-78a6-497a-8f5a-6fa088d4cf71" />

  так можно легко подменять реализации. распиливать ответственности если они разрастаются, менять базы, не трогая основную логику
можно разбить еще больше влоть до микросервисов с брокерами, добавить слоев, дтошек, от размера бизнес-логики, требований и команды завсит уже.
А можно и вообще всю бизнес-логику по DDD выделить отдельно, на F# перенести...

  
